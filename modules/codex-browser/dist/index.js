"use strict";var Ae=Object.create;var Z=Object.defineProperty,Ie=Object.defineProperties,Be=Object.getOwnPropertyDescriptor,Te=Object.getOwnPropertyDescriptors;var ae=Object.getOwnPropertySymbols;var Me=Object.prototype.hasOwnProperty,Ne=Object.prototype.propertyIsEnumerable;var oe=(t,i)=>(i=Symbol[t])?i:Symbol.for("Symbol."+t),C=t=>{throw TypeError(t)};var O=(t,i,e)=>i in t?Z(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e,J=(t,i)=>{for(var e in i||(i={}))Me.call(i,e)&&O(t,e,i[e]);if(ae)for(var e of ae(i))Ne.call(i,e)&&O(t,e,i[e]);return t},A=(t,i)=>Ie(t,Te(i)),ne=(t,i)=>Z(t,"name",{value:i,configurable:!0});var K=t=>{var i;return[,,,Ae((i=t==null?void 0:t[oe("metadata")])!=null?i:null)]},he=["class","method","getter","setter","accessor","field","value","get","set"],T=t=>t!==void 0&&typeof t!="function"?C("Function expected"):t,Oe=(t,i,e,r,a)=>({kind:he[t],name:i,metadata:r,addInitializer:o=>e._?C("Already initialized"):a.push(T(o||null))}),D=(t,i)=>O(i,oe("metadata"),t[3]),d=(t,i,e,r)=>{for(var a=0,o=t[i>>1],h=o&&o.length;a<h;a++)i&1?o[a].call(e):r=o[a].call(e,r);return r},S=(t,i,e,r,a,o)=>{var h,l,w,E,R,c=i&7,G=!!(i&8),v=!!(i&16),z=c>3?t.length+1:c?G?1:2:0,ie=he[c+5],re=c>3&&(t[z-1]=[]),Je=t[z]||(t[z]=[]),b=c&&(!v&&!G&&(a=a.prototype),c<5&&(c>3||!v)&&Be(c<4?a:{get[e](){return f(this,o)},set[e](m){return se(this,o,m)}},e));c?v&&c<4&&ne(o,(c>2?"set ":c>1?"get ":"")+e):ne(a,e);for(var j=r.length-1;j>=0;j--)E=Oe(c,e,w={},t[3],Je),c&&(E.static=G,E.private=v,R=E.access={has:v?m=>De(a,m):m=>e in m},c^3&&(R.get=v?m=>(c^1?f:ee)(m,a,c^4?o:b.get):m=>m[e]),c>2&&(R.set=v?(m,Y)=>se(m,a,Y,c^4?o:b.set):(m,Y)=>m[e]=Y)),l=(0,r[j])(c?c<4?v?o:b[ie]:c>4?void 0:{get:b.get,set:b.set}:a,E),w._=1,c^4||l===void 0?T(l)&&(c>4?re.unshift(l):c?v?o=l:b[ie]=l:a=l):typeof l!="object"||l===null?C("Object expected"):(T(h=l.get)&&(b.get=h),T(h=l.set)&&(b.set=h),T(h=l.init)&&re.unshift(h));return c||D(t,a),b&&Z(a,e,b),v?c^4?o:b:a},s=(t,i,e)=>O(t,typeof i!="symbol"?i+"":i,e),Q=(t,i,e)=>i.has(t)||C("Cannot "+e),De=(t,i)=>Object(i)!==i?C('Cannot use the "in" operator on this value'):t.has(i),f=(t,i,e)=>(Q(t,i,"read from private field"),e?e.call(t):i.get(t)),_=(t,i,e)=>i.has(t)?C("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(t):i.set(t,e),se=(t,i,e,r)=>(Q(t,i,"write to private field"),r?r.call(t,e):i.set(t,e),e),ee=(t,i,e)=>(Q(t,i,"access private method"),e);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});require("core-js-url-browser");const n=require("tabris");class Ve{constructor(){s(this,"primary","");s(this,"primarySecondary","");s(this,"textColor","");s(this,"textSize","");s(this,"textFont","");s(this,"accent","");s(this,"background","rgb(24,24,27)")}}class xe{}s(xe,"dark",new Ve);let M=__dirname;const We=M.length===1?"":(M=M.split("/"),M.pop(),M.join("/")),p=t=>`${We}/assets/${t}.png`,He={dots_vertical:p("dots-vertical"),square:p("square"),square_x:p("square-x"),reload:p("reload"),plus:p("plus"),home:p("home"),history:p("history"),download:p("download"),arrow_up_left:p("arrow-up-left"),arrow_right:p("arrow-right"),arrow_left:p("arrow-left"),bookmarks:p("bookmarks"),square_plus:p("square-plus"),star:p("star"),star_fill:p("star-fill"),circle_minus:p("circle-minus"),dimen:{width:25,height:25}};class u{}s(u,"image",He);function Ue(t){return function(...e){const r=arguments[1],a=r&&r.name&&r.kind;if(a)return o(null,r);function o(h,l){const w=a?r:l;w.addInitializer(function(){Object.defineProperty(this,w.name,t.apply(this,[...e.length===0?[void 0]:e,w,h]))})}return o}}const x=Ue(function(t,i){return{get:()=>Fe.call(this,t!=null?t:i.name)}});function Fe(t){t.startsWith("#")||t.startsWith(".")||(t="#"+t);try{return this.find(t).only()}catch(i){return n.contentView.find(t).only()}}class te extends n.Row{set image(i){this._image=JSX.createElement(n.ImageView,{class:"_image",image:i,width:25,height:25})}set title(i){this._title=JSX.createElement(n.TextView,{centerY:!0,font:"20px serif bold",textColor:"#a4a4a4",class:"_title",text:i[0].toUpperCase()+i.slice(1)})}constructor(i){super(A(J({},i),{spacing:15,padding:15,highlightOnTouch:!0,layoutData:"stretchX"}))}appendChilds(){return this.append(this._image,this._title)}}class Le extends n.Composite{constructor(e={}){super(A(J({},e),{left:0,right:0,top:0,bottom:0,background:"transparent",elevation:99999,data:{open:!1}}));s(this,"_stack",new n.Stack({right:10,left:"40%",background:"rgb(31,41,55)",cornerRadius:8}));const r=a=>{a.preventDefault(),this.dispose()};this.append(this._stack).once("tap",r),n.app.once("backNavigation",r)}_addChild(e,r){this._stack===e?super._addChild(e,r):this._stack.append(e instanceof te?e.appendChilds():e)}calculate(e){const{top:r,height:a}=e.bounds;return this._stack.top=r+10,this}}function qe({target:t,ctxMenu:i}){return i.appendTo(n.contentView).calculate(t)}const B="v0-history";localStorage.getItem(B)||localStorage.setItem(B,JSON.stringify({history:[],bookmarks:[],searched:[]}));let X=JSON.parse(localStorage.getItem(B));const ce=t=>t?X[t]:X,Xe=(t,i={})=>{X[t].splice(0,0,A(J({},i),{time:new Date(Date.now()).toLocaleString()})),localStorage.setItem(B,JSON.stringify(X))},Pe=t=>{X[t]=[],localStorage.setItem(B,JSON.stringify(X))},ye=(t,i,e)=>{X[t]=Ee(t,r=>typeof i=="string"?r.url!==i:r[i.in]!==i.value,e),localStorage.setItem(B,JSON.stringify(X))},Ee=(t,i,e=!0)=>{const r=[];for(const a of X[t])if(i(a)===!0&&(r.push(a),e===!1))break;return r},le=t=>t.parent(n.CollectionView).itemIndex(t);function ue({headerTitle:t,key:i,imageName:e,ctx:r}){let a=ce(i);const o=(h,l)=>{h.find("#s-url").only().text=`<big>${a[l].url}</big>`,h.find("#s-date").only().text=`${a[l].time}`};return JSX.createElement(n.Composite,{id:"viewOfMenu",elevation:1100,background:r.appBrowser.background,stretch:!0},JSX.createElement(n.TextView,{padding:10,textColor:"white",markupEnabled:!0,onTapLink:({target:h})=>{Pe(i),h.parent().find("#user-action-history").first().children().set({opacity:0}).dispose()}},JSX.createElement("b",{textColor:"white",font:"25px system"},t),JSX.createElement("br",null),JSX.createElement("br",null),JSX.createElement("a",null,"eliminar todo")),JSX.createElement(n.Composite,{stretchX:!0,top:"prev() 5",height:3,background:"rgba(83,83,83,0.416)"}),JSX.createElement(n.CollectionView,{itemCount:a.length,updateCell:o,top:"prev() 15",bottom:0,stretchX:!0,id:"user-action-history"},JSX.createElement(n.Setter,{target:n.CollectionView,attribute:"createCell"},()=>JSX.createElement(n.Row,{padding:10,top:"prev()",spacing:5,stretchX:!0,highlightOnTouch:!0,onTap:({target:h})=>r.loadUrl(a[le(h)].url)},JSX.createElement(n.Stack,{left:0,right:25,centerY:!0},JSX.createElement(n.TextView,{textColor:"#999999",stretchX:!0,markupEnabled:!0,id:"s-url"}),JSX.createElement(n.TextView,{textColor:"rgba(175,133,126,0.749)",font:"12px serif normal",id:"s-date"})),JSX.createElement(n.ImageView,A(J({centerY:!0,image:u.image[e]},u.image.dimen),{onTap:({target:h})=>{const l=le(h.parent());ye(i,{in:"time",value:a[l].time},!0);const w=h.parent(n.CollectionView);a=ce(i),w.remove(l);var E=setTimeout(()=>{w.itemCount=a.length,clearTimeout(E)},0)}}))))))}var de,ge,pe,me,fe,we,be,g,V,W,H,I,U,F,Ce;class y extends(be=n.Composite,we=[x()],fe=[x()],me=[x()],pe=[x()],ge=[x()],de=[x()],be){constructor(e={}){super(A(J({},e),{left:0,right:0,padding:10,elevation:10,background:"rgba(0,0,0,0.089)"}));_(this,F);s(this,"_boundHeight",0);s(this,"_boundWidth",0);s(this,"_isActiveInput",!1);s(this,"_isMenuActive",!1);s(this,"inputSearch",d(g,8,this)),d(g,11,this);s(this,"action",d(g,12,this)),d(g,15,this);s(this,"contentSearch",d(g,16,this)),d(g,19,this);s(this,"ctx_menu",d(g,20,this)),d(g,23,this);s(this,"imgStar",d(g,24,this)),d(g,27,this);s(this,"viewOfMenu",d(g,28,this)),d(g,31,this);s(this,"reloadNavigation",()=>{this.ctx_menu.trigger("tap")});s(this,"forwardNavigation",()=>{this.ctx_menu.trigger("tap"),this.appBrowser.goForward()});s(this,"backNavigation",()=>{this.ctx_menu.trigger("tap"),this.appBrowser.goBack()});s(this,"addBookMark",()=>{this.ctx_menu.trigger("tap")});s(this,"starBookmark",e=>{const r=this.appBrowser.webview.url;if(!r||!this._isMenuActive)return;Ee("bookmarks",o=>o.url===r).length>0?(this.imgStar.image=e?u.image.star:u.image.star_fill,e&&ye("bookmarks",r)):(this.imgStar.image=e?u.image.star_fill:u.image.star,e&&r&&Xe("bookmarks",{url:r}))});s(this,"showBookmarks",()=>{this.appBrowser.append(JSX.createElement(ue,{headerTitle:"Marcadores",key:"bookmarks",imageName:"circle_minus",ctx:this})),this.ctx_menu.trigger("tap"),this._isMenuActive=!0});s(this,"showHistory",()=>{this.appBrowser.append(JSX.createElement(ue,{headerTitle:"Historial",key:"history",imageName:"square_x",ctx:this})),this.ctx_menu.trigger("tap"),this._isMenuActive=!0});_(this,V,e=>{this._isActiveInput&&(this._isActiveInput=!1,this.inputSearch.selection=[0,0],this.inputSearch.focused=!1,f(this,I).call(this),e.preventDefault());try{this._isMenuActive&&(this._isMenuActive=!1,this.viewOfMenu.dispose(),e.preventDefault())}catch(r){}});_(this,W,({target:e})=>{this._isMenuActive=!0,qe({target:e,ctxMenu:JSX.createElement(Le,{id:"ctx_menu"},JSX.createElement(n.Composite,{stretchX:!0,background:"rgb(17,24,39)"},JSX.createElement(n.Composite,{left:0,right:"75%",padding:10,highlightOnTouch:!0,onTap:this.backNavigation},JSX.createElement(n.ImageView,{centerX:!0,image:u.image.arrow_left,height:u.image.dimen.height,width:u.image.dimen.width})),JSX.createElement(n.Composite,{right:"25%",left:"prev()",padding:10,highlightOnTouch:!0,onTap:this.forwardNavigation},JSX.createElement(n.ImageView,{centerX:!0,image:u.image.arrow_right,width:u.image.dimen.width,height:u.image.dimen.height})),JSX.createElement(n.Composite,{left:"75%",right:0,padding:10,highlightOnTouch:!0,onTap:this.starBookmark},JSX.createElement(n.ImageView,{centerX:!0,id:"imgStar",image:u.image.star,width:u.image.dimen.width,height:u.image.dimen.height}))),JSX.createElement(te,{image:u.image.history,title:"historial",onTap:this.showHistory}),JSX.createElement(te,{image:u.image.bookmarks,title:"marcadores",onTap:this.showBookmarks}))}),this.starBookmark(),this.ctx_menu.once("dispose",()=>{this._isMenuActive=!1})});_(this,H,()=>{this._isActiveInput=!0,this.animateHeight(),this.contentSearch.right=0,this.action.animate({transform:{translationX:150}},{duration:200,easing:"ease-out"})});_(this,I,()=>{this._isActiveInput=!1,this.inputSearch.text.trim()!==this.appBrowser.webview.url&&(this.inputSearch.text=this.appBrowser.webview.url),this.contentSearch.right="#action 10",this.set({height:this._boundHeight}),this.action.animate({transform:{translationX:0}},{duration:100,easing:"ease-in"})});_(this,U,({text:e})=>{this.inputSearch.focused=!1,this._isActiveInput=!1,f(this,I).call(this),/http(s)?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/.test(e)&&this._handlerAccept(e,this)});ee(this,F,Ce).call(this)}set inAppBrowser(e){this.appBrowser=e}set handlerAccept(e){this._handlerAccept=e}getPercentAnimate(){this._boundHeight=this.bounds.height,this._boundWidth=this.bounds.width;const{height:e,bottom:r,width:a}=this.parent().bounds,o=25*Math.abs(e-this._boundHeight)/100;return{incrementWidth:25*Math.abs(a-this._boundWidth)/100,incrementHeight:o,heightParent:e,widthParent:a}}animateHeight(){const{incrementHeight:e,heightParent:r,incrementWidth:a,widthParent:o}=this.getPercentAnimate();let h=setInterval(()=>{r>=this.bounds.height?this.set({height:e+this.bounds.height}):clearInterval(h)},0)}loadUrl(e){this._isMenuActive=!1,this._handlerAccept(e,this),this.viewOfMenu.dispose()}isNotActiveWidget(){return this._isMenuActive===!1&&this._isActiveInput===!1}}g=K(be),V=new WeakMap,W=new WeakMap,H=new WeakMap,I=new WeakMap,U=new WeakMap,F=new WeakSet,Ce=function(){this.append(JSX.createElement($,null,JSX.createElement(n.Composite,{left:0,right:"#action 10",id:"contentSearch"},JSX.createElement(n.TextInput,{message:"ingresa la url",id:"inputSearch",cornerRadius:20,floatMessage:!1,keyboard:"ascii",messageColor:"gray",textColor:"white",type:"search",keepFocus:!0,borderColor:"transparent",background:"rgba(231,231,231,0.255)",enterKeyType:"search",onFocus:f(this,H),onBlur:f(this,I),onAccept:f(this,U),top:0,stretchX:!0})),JSX.createElement(n.Row,{right:0,top:10,id:"action",spacing:0},JSX.createElement(n.ImageView,{padding:[0,10],highlightOnTouch:!0,image:u.image.dots_vertical,height:u.image.dimen.height,onTap:f(this,W)})))),n.app.on("backNavigation",f(this,V))},S(g,5,"inputSearch",we,y),S(g,5,"action",fe,y),S(g,5,"contentSearch",me,y),S(g,5,"ctx_menu",pe,y),S(g,5,"imgStar",ge,y),S(g,5,"viewOfMenu",de,y),D(g,y);var ve,Se,_e,ke,k,L,q,P;class N extends(ke=n.Composite,_e=[x()],Se=[x()],ve=[x()],ke){constructor({url:e="",controlUrl:r=!1,events:a={}}={}){super({left:0,right:0,top:0,bottom:0,background:xe.dark.background});s(this,"_linksPage");s(this,"_isWriteInput",!1);s(this,"_dateEndLoad");s(this,"webview",d(k,8,this)),d(k,11,this);s(this,"searchNav",d(k,12,this)),d(k,15,this);s(this,"starBookmark",d(k,16,this)),d(k,19,this);s(this,"goBack",e=>{var r,a;this.webview.canGoBack&&((r=this.searchNav)!=null&&r.isNotActiveWidget())?(this.webview.goBack(),e==null||e.preventDefault(),typeof this.events.onGoBack=="function"&&this.events.onGoBack()):(a=this.searchNav)!=null&&a.isNotActiveWidget()&&!this.webview.canGoBack&&typeof this.events.onExit=="function"&&this.events.onExit(e,this)});s(this,"goForward",()=>{this.webview.canGoForward&&(this.webview.goForward(),typeof this.events.onGoForward=="function"&&this.events.onGoForward())});s(this,"onAcceptSearch",(e,r)=>{this._isWriteInput=!0,this.webview.url=e,this.webview.excludeFromLayout=!1});_(this,L,({target:e,data:r})=>{if(r.includes("type")&r.includes("@webview/")){const{title:a,links:o}=JSON.parse(r);this.linksPage=o,console.log(a,"page title")}});_(this,q,e=>{var{url:r,target:a}=e;if(r.startsWith("intent"))return e.preventDefault();try{var{hostname:o}=new URL(r),{hostname:h}=new URL(a.url)}catch(l){return e.preventDefault()}typeof this.events.onBeforeChangeUrl=="function"&&this.events.onBeforeChangeUrl(e),this.controlUrl!==!1&&(Date.now()-this._dateEndLoad<100&&console.log("redireccion"),!this._isWriteInput&&!this.isEqualHostname(o,h)&&e.preventDefault(),!this._isWriteInput&&(a.url!==r&&!o.includes(h)||r.includes("ads"))&&e.preventDefault())});_(this,P,e=>{Date.now()-this._dateEndLoad<1e3||(this._dateEndLoad=Date.now(),this._isWriteInput=!1,this.searchNav.inputSearch.text=this.webview.url,this.searchNav.inputSearch.selection=[0,0],Xe("history",{url:this.webview.url}),typeof this.events.onChangedUrl=="function"&&this.events.onChangedUrl(e))});this.controlUrl=r,this.events=a,n.app.on("backNavigation",this.goBack),this.append(JSX.createElement($,null,JSX.createElement(y,{id:"searchNav",inAppBrowser:this,handlerAccept:this.onAcceptSearch}),JSX.createElement(n.WebView,{id:"webview",excludeFromLayout:!0,top:"prev()",bottom:0,onLoad:f(this,P),onNavigate:f(this,q),onMessage:f(this,L),onUrlChanged:o=>{},stretchX:!0}))).on("dispose",()=>n.app.off("backNavigation",this.goBack)),e.length>0&&this.onAcceptSearch(e)}isEqualHostname(e,r){const a=e.split("."),o=r.split(".");return a.filter(l=>o.some(w=>w===l)).length>1}}k=K(ke),L=new WeakMap,q=new WeakMap,P=new WeakMap,S(k,5,"webview",_e,N),S(k,5,"searchNav",Se,N),S(k,5,"starBookmark",ve,N),D(k,N);exports.InAppBrowser=N;
